generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  birthDate String?
  phone     String?
  gender    String?
  plan_tier String   @default("standard")
  role      String   @default("USER") // ADMIN ou USER
  plan      String   @default("PERFORMANCE") // FREE, ELITE, VIP
  active    Boolean  @default(true) // Controle de acesso
  createdAt DateTime @default(now())

  // ðŸ‘‡ GAMIFICATION
  currentXP Int      @default(0)
  
  // Relacionamentos
  workouts    Workout[]
  anamneses   Anamnese[]
  history     WorkoutHistory[] 
  assessments Assessment[]     
  checkIns    CheckIn[]        // <--- CORREÃ‡ÃƒO: Faltava este campo
}

model Exercise {
  id           String   @id @default(uuid())
  name         String   @unique
  category     String
  videoUrl     String?
  instructions String?
  createdAt    DateTime @default(now())
  
  // Relacionamentos
  // 1. Quando este exercÃ­cio Ã© o principal da ficha
  workoutExercises WorkoutExercise[] 

  // 2. Quando este exercÃ­cio Ã© usado como substituto de outro (CORREÃ‡ÃƒO AQUI)
  asSubstitute     WorkoutExercise[] @relation("SubstituteRelation")
}

model Workout {
  id        String    @id @default(uuid())
  name      String    
  goal      String?   
  level     String?   
  isVisible Boolean   @default(true)
  
  // Planejamento e Arquivamento
  startDate DateTime? @default(now()) 
  endDate   DateTime? 
  archived  Boolean   @default(false) 
  
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  exercises WorkoutExercise[]
  createdAt DateTime  @default(now())
}

model WorkoutExercise {
  id        String   @id @default(uuid())
  workoutId String
  workout   Workout  @relation(fields: [workoutId], references: [id], onDelete: Cascade)
  
  // ExercÃ­cio Principal
  exerciseId String
  exercise   Exercise @relation(fields: [exerciseId], references: [id])
  
  // ExercÃ­cio Substituto (Opcional)
  substituteId String?
  substitute   Exercise? @relation("SubstituteRelation", fields: [substituteId], references: [id])

  restTime  Int      @default(60)
  title     String?  
  sets      Int      @default(3)
  reps      String   @default("12") 
  notes     String?  
  technique String?  
  day       String   @default("A") 
  order     Int      @default(0) 
}

model Anamnese {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Dados FÃ­sicos Iniciais
  peso            Float
  altura          Float
  imc             Float?    
  objetivo        String    
  nivel           String    
  frequencia      Int      
  tempoDisponivel Int      @default(60) 
  limitacoes      String[] 
  cirurgias       String[] 
  equipamentos    String[] 
  
  createdAt       DateTime @default(now())
}

model WorkoutTemplate {
  id        String   @id @default(uuid())
  name      String   
  goal      String   
  level     String   
  data      String   @db.Text 
  createdAt DateTime @default(now())
}

// HistÃ³rico de Treinos Realizados (Gamification)
model WorkoutHistory {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name      String   // Ex: "Treino A - Peito"
  workoutName String? // Nome da ficha original (Backup)
  date      DateTime @default(now())
  xpEarned  Int      @default(0)
  duration  Int?     
  
  // Para mostrar no feed se bateu recordes
  progressions Int     @default(0) 

  details   ExerciseHistory[]
}

model ExerciseHistory {
  id               String         @id @default(uuid())
  workoutHistoryId String
  workoutHistory   WorkoutHistory @relation(fields: [workoutHistoryId], references: [id], onDelete: Cascade)
  
  exerciseId       String
  exerciseName     String
  
  // Detalhes da sÃ©rie feita
  setNumber        Int
  weight           Float  
  reps             String 
}

// AVALIAÃ‡ÃƒO FÃSICA
model Assessment {
  id             String   @id @default(uuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date           DateTime @default(now())
  
  // NÃVEL 1: BÃSICO
  weight         Float    
  height         Float?   
  photos         String[] 
  
  // NÃVEL 2: MEDIDAS (cm)
  neck           Float?   
  shoulders      Float?   
  chest          Float?   
  arms           Float?   
  forearms       Float?   
  waist          Float?   
  abdomen        Float?   
  hips           Float?   
  thighs         Float?   
  calves         Float?   
  
  // NÃVEL 3: COMPOSIÃ‡ÃƒO / POLLOCK (mm)
  method         String?  // "POLLOCK_7", "BIO", "MANUAL"
  
  foldTriceps      Float?
  foldSubscapular  Float?
  foldChest        Float?
  foldAxillary     Float?
  foldSuprailiac   Float?
  foldAbdominal    Float?
  foldThigh        Float?
  
  // Resultados Finais
  bodyFat        Float?   
  visceralFat    Float?   
  muscleMass     Float?   
  
  notes          String?  
  createdAt      DateTime @default(now())
}

// CHECK-IN DO ALUNO
model CheckIn {
  id         String   @id @default(uuid())
  date       DateTime @default(now())
  
  weight     Float?
  feedback   String?  
  
  photoFront String? 
  photoBack  String?
  photoSide  String?
  
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt  DateTime @default(now())
}